<script>
	let xhr = new XMLHttpRequest();
	function post_command(command_param) {
		alert(command_param.alert_text);

		const xhr = new XMLHttpRequest();
		xhr.open('POST', '/command');
		xhr.setRequestHeader("Content-Type", "application/json");
		xhr.responseType = 'text';

		xhr.onreadystatechange = function(){
		if(xhr.readyState === XMLHttpRequest.DONE) {
		// XMLデータ取得
		let data = JSON.parse(xhr.responseText);
		//alert(data);
		//data = data.replace(/\n/g, "<BR />");
				try {
					document.getElementById("resXmlHttpRequestObj").innerHTML=`<pre>${JSON.stringify(data,null," ")}</pre>`;
				} catch (err) {
					document.getElementById("resXmlHttpRequestObj").innerHTML=`<pre>${JSON.stringify(err,null," ")}</pre>`;
				}
			}
		}
		xhr.send(JSON.stringify(command_param));
	}
</script>

<% let special = page?.specialParams ?? [] %>
<% if(query?.TEST){ 
	common.ghomeSpeakers = [
		{speakerName : "りびんぐ", speakerAddress : "192_168_1_150" },
		{speakerName : "あおいろ", speakerAddress : "192_168_1_160" },
	];
} %>
	
<div class="container">
	<div class="row mt-2">
		<label>ろくおんするじかんをえらんでね</label>
	<select class="form-select" id="RecTime" aria-label="ろくおんするじかんをえらんでね">
		<option value="2">2秒</option>
		<option value="5" selected>5秒</option>
		<option value="10">10秒</option>
		<option value="20">20秒</option>
		<option value="60">1分</option>
	</select>
	
		
	<% let g_addr = common.ghomeSpeakers %>
		<% if(g_addr.length == 0){ %>
			<%- '<P>ねっとわーくのなかに、ぐーぐるさんがみつかりません</p>' %>
    <% } else g_addr.forEach(e=> {%>
       	<button class="btn btn-primary my-2" type="submit" id="<%- e.speakerAddress %>" value="google|<%- e.speakerName %>" name="submit">ぐーぐるさん(<%- e.speakerName %>)がしゃべる</button>
		<script>
			document.getElementById("<%- e.speakerAddress %>").onclick=()=>{
				let t = document.getElementById("RecTime").value;
				post_command({
					alert_text : 'ボイスチェンジャー',
					mode : 'rec_voice',
					data : {
						output : 'speaker',
						SpeakerAddress : '<%- e.speakerAddress %>',
						length: t,
					},
					short_return : true
				});
			};
		</script>
    <% }) %>
        <button class="btn btn-secondary my-2" type="submit" id="otosan" value="otosan" name="submit">おとうさんにおくる</button>

		<script>
			document.getElementById("otosan").onclick=()=>{
				let t = document.getElementById("RecTime").value;
				post_command({
					alert_text : 'おとうさんにろくおんしたおんせいをおくります',
					mode : 'rec_voice',
					data : {
						output : 'send_mail',
						length: t,
					},
					short_return : true
				});
			};
		</script>

		<div class="row mt-2"><p id="resXmlHttpRequestObj"></p></div>
    </div>
</div>

