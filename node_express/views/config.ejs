<% let g_addr = common.ghomeSpeakers %>

<button id="clean_wav" class="btn btn-primary mx-2">たまったおんせいファイルをしょうきょする</button>
<br/>
<br/>
<button id="update_reboot_webserver" class="btn btn-primary mx-2">ウェブサーバをアップデートしてさいきどうする</button>
<br/>
<button id="reboot_webserver" class="btn btn-primary mx-2">ウェブサーバをさいきどうする</button>
<br/>
<br/>
<button id="show_log" class="btn btn-primary mx-2">ログをひょうじする</button>
<br/>
<br/>
<button id="show_version" class="btn btn-primary mx-2">バージョンをひょうじする</button>

<p>
	<P id="resXmlHttpRequestObj"></P>
</p>

<script type="text/javascript">

	document.getElementById('clean_wav').onclick = function() {
		post_command({
			alert_text : 'おんせいファイルをしょうきょします。',
			mode : 'clean_wav',
			short_return : true
		});
	}

	document.getElementById('update_reboot_webserver').onclick = function(){
		post_command({
			alert_text : 'ウェブサーバをアップデートしてさいきどうします。',
			mode : 'update_reboot',
			command : '',
			short_return : true
		});
	}

	document.getElementById('reboot_webserver').onclick = function(){
		post_command({
			alert_text : 'ウェブサーバをさいきどうします。',
			mode : 'reboot',
			command : '',
			short_return : true
		});
	}

	document.getElementById('show_log').onclick = function(){
		post_command({
			alert_text : 'ログを表示します。',
			mode : 'system_command',
			command : 'cat out.log',
			short_return : true
		});
	}

	document.getElementById('show_version').onclick = function(){
		post_command({
			alert_text : 'バージョンを表示します。',
			mode : 'system_command',
			command : 'git log -1',
			short_return : true
		});
	}


	let xhr = new XMLHttpRequest();
	function post_command(command_param) {
		alert(command_param.alert_text);

		const xhr = new XMLHttpRequest();
		xhr.open('POST', '/command');
		xhr.setRequestHeader("Content-Type", "application/json");
		xhr.responseType = 'text';

		xhr.onreadystatechange = function(){
			if(xhr.readyState === XMLHttpRequest.DONE) {
				// XMLデータ取得
				let data = JSON.parse(xhr.responseText);
				data = data.replace(/\n/g, "<BR />");
	
				try {
					document.getElementById("resXmlHttpRequestObj").innerHTML=`<pre>${JSON.stringify(data,null," ")}</pre>`;
				} catch (err) {
					document.getElementById("resXmlHttpRequestObj").innerHTML=`<pre>${JSON.stringify(err,null," ")}</pre>`;
				}
			}
		}
		xhr.send(JSON.stringify(command_param));
	}
	
</script>
