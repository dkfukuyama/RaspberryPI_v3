<% let g_addr = common.ghomeSpeakers %>

<button id="clean_wav" class="btn btn-primary mx-2">たまったおんせいファイルをしょうきょする</button>
<br/>
<br/>
<button id="update_reboot_webserver" class="btn btn-primary mx-2">ウェブサーバをアップデートしてさいきどうする</button>
<br/>
<button id="reboot_webserver" class="btn btn-primary mx-2">ウェブサーバをさいきどうする</button>
<br/>
<br/>
<br/>
<button id="show_log" class="btn btn-primary mx-2">ログをひょうじする</button>

<p>
	<P id="resXmlHttpRequestObj"></P>
</p>

<script type="text/javascript">

	document.getElementById('clean_wav').onclick = function() {
		post_command({
			alert_text : 'おんせいファイルをしょうきょします。',
			mode : 'clean_wav',
			return_header : 'text/plain',
			short_return : true
		});
	}

	document.getElementById('update_reboot_webserver').onclick = function(){
		post_command({
			alert_text : 'ウェブサーバをアップデートしてさいきどうします。',
			mode : 'update_reboot',
			command : 'sudo systemctl restart pi_server',
			return_header : 'text/plain',
			short_return : true
		});
	}

	document.getElementById('reboot_webserver').onclick = function(){
		post_command({
			alert_text : 'ウェブサーバをさいきどうします。',
			mode : 'reboot',
			command : 'sudo reboot',
			return_header : 'text/plain',
			short_return : true
		});
	}

	document.getElementById('show_log').onclick = function(){
		post_command({
			alert_text : 'ログを表示します。',
			mode : 'system_command',
			command : 'sudo systemctl status pi_server -n 80 | cat',
			return_header : 'text/plain',
			short_return : true
		});
	}

	let xhr = new XMLHttpRequest();
	function post_command(command_param) {
		alert(command_param.alert_text);
		
		let snd = JSON.stringify(command_param);
		let xhr = new XMLHttpRequest();
		xhr.open('POST', '/command');
		xhr.setRequestHeader("Content-Type", "application/json");
		xhr.onreadystatechange = function(){
			// XMLデータ取得
			let data = xhr.responseText;
			let j = null;
			try {
				j = JSON.parse(data);
				document.getElementById("resXmlHttpRequestObj").innerHtml=`<pre>${JSON.stringify(j,null," ")}</pre>`
			} catch (error) {
				document.getElementById("resXmlHttpRequestObj").innerHtml=`<pre>${data}</pre>`;
			}
		}
		xhr.send(snd);
	}
	
</script>
